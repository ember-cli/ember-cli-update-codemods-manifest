language: node_js
node_js:
- '10'
- node
branches:
  only:
  - master
  # npm version tags
  - /^(?:[a-z-]+|@[a-z-]+\/[a-z-]+)@\d+\.\d+\.\d+$/
cache:
  npm: false
env:
  global:
  - DEBUG=ember-cli-update,boilerplate-update,git-diff-apply,git-fixtures
stages:
  - lint
  - test
  - deploy
before_install:
- curl -L https://unpkg.com/@pnpm/self-installer | node
install:
- pnpm install
jobs:
  allow_failures:
  - os: osx
  include:
  - stage: lint
    script:
    - npm run lint:git
    - npm run lint:js
  - stage: test
    env:
    - TEST_TYPE=addon
  - os: osx
  - stage: deploy
    if: branch = master AND tag IS blank AND type = push
    script:
    - git checkout -B master
    - git config user.email "travis@travis-ci.org"
    - git config user.name "Travis CI"
    - git remote set-url origin https://$GITHUB_TOKEN@github.com/ember-cli/ember-cli-update-codemods-manifest.git
    - git fetch
    - git branch -u origin/master
    - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" >> ~/.npmrc
    - npm run release
