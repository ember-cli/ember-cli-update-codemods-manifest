language: node_js
node_js:
- '8'
- node
branches:
  only:
  - master
  # npm version tags
  - /^(?:[a-z-]+|@[a-z-]+\/[a-z-]+)@\d+\.\d+\.\d+$/
cache:
  npm: false
env:
  global:
  - DEBUG=ember-cli-update,boilerplate-update,git-diff-apply,git-fixtures
before_install:
- curl -L https://unpkg.com/@pnpm/self-installer | node
install:
- pnpm install
jobs:
  allow_failures:
  - os: osx
  include:
  - os: osx
  - script:
    - npm run lint:git
    - npm run lint:js
  - if: branch = master AND tag IS blank AND type = push
    script:
    - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" >> ~/.npmrc
    - git checkout master
    - git config --global user.email "travis@travis-ci.org"
    - git config --global user.name "Travis CI"
    - git remote remove origin
    - git remote add origin https://$GITHUB_TOKEN@github.com/ember-cli/ember-cli-update-codemods-manifest.git
    - git fetch origin
    - git branch -u origin/master
    - npm run release
